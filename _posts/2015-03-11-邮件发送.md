---
layout: post
title: "邮件发送"
description: "ruby, 邮件发送"
---

## 前言

仔细想想，关于邮件发送的任务也是从年前拖到了年后。看样子拖不下去了，我这周要将其搞定收工。然后，腾出手来做其他的事情。

## 正文

我觉得，一个项目迭代了两年，就会存在各种各样的"垃圾"，比如，发送邮件存在xx种形式。针对邮件的功能，在项目中做了一番调查: 

* mailchimp-api
* resque_mailer
* Action Mailer
* SendCloud

> 备注: 邮件的事情，咨询了相关人之后，得知mailchimp-api可能就不需要了。

Rails 使用 Action Mailer实现邮件发送，邮件程序和视图，`ActionMailer::Base`，与控制器类似，`app/mailers`和`app/views`，简单的例子程序如下: 

```ruby
class UserMailer < ActionMailer::Base
  default from: 'notifications@example.com'

  def welcome_email(user)
    @user = user
    @url = 'http://example.com/login'
    mail(to: @user.email, subject: 'Welcome to My Awesome Site')
  end
end
```

邮件程序不知道请求的上下文，需要指定host，使用`xxx_url`，或使用`url_for`时，指定`only_path: false`。

Action Mailer中也可设置`before_action`、`after_action` 和 `around_action`这些过滤器。

Action Mailer继承自AbstractController，控制器中的帮助方法均可使用。

Mailer选项最好在环境相关的文件(environment.rb, production.rb)中进行配置。



## 后记

近来，觉得自己十分的平庸，干啥啥不成。因为又有一件事情干到一半，然后放在一边了，比如邮件的这次任务。

我觉得，我这种性格还是有一定的好处的。
