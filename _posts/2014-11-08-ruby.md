---
layout: post
title: Ruby学习笔记
category : ruby
---

## 前言

虽然从事RoR工作快5个月了，老实说，ruby学的并不怎么样。工作时，要用到某个东西，都是百度上搜的，看起来挺业余的，总不是个办法，决定系统的学习一下。

## 杂记

哈希中的键名可以是符号，哈希的each用法: 

```ruby
ad =  {name: "邪王真眼", location: "Earth"}
ad.each do |k,v|
  puts "#{k}: #{v}"
end
```

`=~`是用来正则表达式匹配的，顺序可颠倒：/pattern/i =~ "String"

## 创建命令

从命令行中读取数据(以空格分隔)，`ARGV数组`存放命令行参数。Ruby实现Unix的grep命令:

```ruby
# simple_grep.rb
# 使用方式： simple_grep.rb pattern filename
pattern = Regexp.new ARGV[0]
filename = ARGV[1]

file =  File.open(filename)
file.each_line do |line|    # 迭代器 + 正则表达式的用法还真是强大
  print line if pattern =~ line
end

file.close
```

稍微模块化的版本： 

```ruby
def simple_grep(pattern, filename)
  file =  File.open(filename)
  file.each_line do |line|
    print line if pattern =~ line
  end

  file.close
end

simple_grep Regexp.new(ARGV[0]), ARGV[1]
```
> 一直不知道grep命令使用方法: grep pattern filename。不过常用git grep和ack, 就使用经验而言，后两者要很多，应为存在默认的选项(默认当前工作区和默认当前目录)。

命名，变量类型：全局变量$，实例变量@，类变量@@(不太明白作用，难道是类方法)

多重赋值的优点：交换值只需要一行代码，使用数组给多个值赋值，组合变量名。

条件 - Ruby的谓词方法。逻辑运算符，case语句的示例： 

```ruby
tags = [ "A", "IMG" , "PRE" ]
tags.each do |tag|
  case tag
  when "P", "A", "I","B","BLOCKQUITE" # when语句可以是这样多条件，也可以是正则表达式
    p "#{tag} 是王八蛋"
  when "IMG", "BR"
    p "#{tag} 是牛顿"
  else
    p "邪王正眼，最强之眼！"
  end
end
```

**问题**： 上述这段代码在运行过程中出现了一点问题，`invalid multibyte char (US-ASCII)`，而在irb中是正常的，解决方法是在文件首部添加`# encoding: utf-8`，并使用`ruby case.rb`而不是`./case.rb`这样的运行方式。

`===`操作符，左值为数值或字符串时，同`==`含义相同; 可以用作`=~`的作用，可以判断右边的对象是否属于左边的类，广义上的相等。

对象的同一性，object_id(`__id__`)相同。

循环语句: times, while, each, for, until, loop。循环控制：break, next, redo, 如下是循环控制例子: 

```ruby
puts "break example "
i = 0
["Perl", "Python", "Ruby", "Scheme"].each do |lang|
  i += 1
  break if i == 3
  p [i,lang]
end

p "next example "
i = 0
["Perl", "Python", "Ruby", "Scheme"].each do |lang|
  i += 1
  next if i == 3
  p [i,lang]
end

p "redo example "
i = 0
["Perl", "Python", "Ruby", "Scheme"].each do |lang|
  i += 1
  redo if i == 3
  p [i,lang]
end
# 输出结果：
# break example 
# [1, "Perl"]
# [2, "Python"]
# "next example "
# [1, "Perl"]
# [2, "Python"]
# [4, "Scheme"]
# "redo example "
# [1, "Perl"]
# [2, "Python"]
# [4, "Ruby"]
# [5, "Scheme"]
```
## 方法

调用方法： 向对象发送消息(message)。其形式有：带块的方法调用，运算符形式的方法调用(+, =~, -,!, [],[]=)。

方法的分类: 实例方法(接受者为对象)，类方法(self.xxx，接收者为类)，函数式方法(不需要接收者)

参数个数不确定的方法定义: 

```ruby
def foo(*args)
  args.class  # 在irb中测试了一下，发现args实际是个Array类型的数组
end
```

ruby 2.0支持所谓的关键字参数: `def foo( key: value[,key: value])` 即可使用散列传参，未定义参数: `**agrs`参数接受
