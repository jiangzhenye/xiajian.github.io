---
layout: post
title: 阿里云的初体验
description: "阿里云，nginx，ab测试"
---

## 前言

昨天，买了青岛的1核1G的阿里ECS，想想用来干啥呢？ 用来测试和部署吧。以下是探索经过程。

## 探索

安装nginx，apache2-utils(包含ab测试工具)，rbenv，ruby等。部署测试的应用程序是Discourse。

> Discourse的依赖项和安装环境都太过复杂了，1G1核根本玩不下去。在思考阿里云的基础虚拟化到底是怎么做到了时
> 想到，不会是使用的xen吧，还是直接购买的VMware的虚拟化服务，不过后者看起来不太可能。毕竟装机量实在太大了。

## 挂载购买的数据盘

fdisk, mount, mkfs.ext4(居然真的有这种命令), df -h

### ab测试

命令: ab -n1000 -c10 http://115.28.165.58/

结果: 

本地测试服务器效果: 

```
Server Software:        nginx/1.4.6
Server Hostname:        115.28.165.58
Server Port:            80

Document Path:          /
Document Length:        612 bytes

Concurrency Level:      10
Time taken for tests:   10.100 seconds
Complete requests:      1000
Failed requests:        0
Total transferred:      853000 bytes
HTML transferred:       612000 bytes
Requests per second:    99.01 [#/sec] (mean)
Time per request:       100.996 [ms] (mean)
Time per request:       10.100 [ms] (mean, across all concurrent requests)
Transfer rate:          82.48 [Kbytes/sec] received
```

服务器本地测试结果:

```
Server Software:        nginx/1.4.6
Server Hostname:        115.28.165.58
Server Port:            80

Document Path:          /
Document Length:        612 bytes

Concurrency Level:      10
Time taken for tests:   0.149 seconds
Complete requests:      1000
Failed requests:        0
Total transferred:      853000 bytes
HTML transferred:       612000 bytes
Requests per second:    6720.66 [#/sec] (mean)
Time per request:       1.488 [ms] (mean)
Time per request:       0.149 [ms] (mean, across all concurrent requests)
Transfer rate:          5598.36 [Kbytes/sec] received
```

> 上面的结果还是很不错的，虽然只是请求简单的静态首页。毕竟，机器的配置(1核1G)不怎么样。

修改本地hosts，将自己的阿里云的服务器取名为test.com。

## ruby和node安装

node安装: 

```
wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.23.3/install.sh | bash
nvm install 0.10
nvm alias default 0.10.32
```

ruby安装: 


```
git clone git://github.com/sstephenson/rbenv.git ~/.rbenv
# 用来编译安装 ruby
git clone git://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
# 用来管理 gemset, 可选, 因为有 bundler 也没什么必要
git clone git://github.com/jamis/rbenv-gemset.git  ~/.rbenv/plugins/rbenv-gemset
# 通过 gem 命令安装完 gem 后无需手动输入 rbenv rehash 命令, 推荐
git clone git://github.com/sstephenson/rbenv-gem-rehash.git ~/.rbenv/plugins/rbenv-gem-rehash
# 通过 rbenv update 命令来更新 rbenv 以及所有插件, 推荐
git clone https://github.com/rkh/rbenv-update.git ~/.rbenv/plugins/rbenv-update

rbenv install 1.9.3
rbenv global 1.9.3
```

rbenv不好用，换回rvm，结果，发现，rvm更加坑爹，慢的要死，搞得我想换系统，结果没换成。算了，还是继续用rvm吧。

再次使用rvm时，注意到，RVM是自动安装Ruby的依赖库的，rbenv确不会，所以，前者在使用时，缺少了zlib。此外，rvm的安装的依赖库为: 
gawk, libreadline6-dev, zlib1g-dev, libssl-dev, libyaml-dev, libsqlite3-dev, sqlite3, autoconf, libgdbm-dev, libncurses5-dev, automake, libtool, bison, pkg-config, libffi-dev

> 好长一坨依赖项。此次观察体验，rbenv的编译要比rvm更耗cpu。rvm安装的全局依赖项要多一些，也要省事一些。

将自己blog生成的静态页面放到`/usr/share/nginx/html/`, 请求处理立马下降到了10个每秒。

> 备注: 2月11日，到4点钟为止，所有的探索均为失败的。算了，不想玩这个了。

## linux系统

阿里云的ubuntu镜像意外的对系统进行一定程度的优化？ 比如 `ulimit -a`，难道是服务器操作系统的原因。

> 从系统微观调优上来考虑，centos要比ubuntu在细节上做的好。

su切换root权限太不安全，admin分组和相应用户: groupadd & useradd，仅限开发环境中。

程序的后台运行: & 和 nohup。

