---
layout: post
title: 尝试newrelic
description: "newrelic, 性能监控工具，server，应用程序"
---

## 前言

一直为server和应用没有监控感到不安，上周申请的newrelic，昨天和今天研究了一下，newrelic，感觉相当的不错。

## 正文

newrelic提供了多种功能，多种产品的性能监控，server，application，mobile之类的。

使用: 

1. 先在`Gemfile`中添加`gem 'newrelic_rpm'`，然后bundle一下
2. 下载对应的newrelic.yml文件
3. 等待后，可参看各种图表: 请求响应时间图表、Apdex图表、吞吐量图标、请求时间排名(可深入研究并优化)、错误率、服务器状态表。

最重要的就是**请求响应时间图表**，以下是图例: 

<div class="pic">
  <img src="/assets/images/webrt.png" alt="请求响应时间图表"/>
</div>

仔细观察这张图，可以发现这样的几点内容: 

* 中间件的处理时间比较平稳，基本在50ms之下
* db和ruby的处理时间波动较大，其中，db的处理时间波动极大，极其不规则。这种不规则的数据访问方式，有可能导致db的压力非常大，数据库容易崩溃。


经验: 

在阿里云上使用第三方的监控工具，数据好像不能正确的发送出去，而且监控的指标比较贫乏，还不如我使用top进行监控，试了一下后，又删掉了(newrelic-sysmond)。

判断失误了，不是newrelic不起作用，是自己太过心急了，newrelic-sysmond进程要把数据发送过去是需要时间的。newrelic服务器总览表提供的数据不多，但是，重要
的参数指标都有了: CPU, 磁盘I/O, 内存，磁盘使用率。只要这几个总体的指标没问题，服务器也就没太大的问题。

附: 

安装操作: 

```sh
# centos特定
rpm -Uvh http://download.newrelic.com/pub/newrelic/el5/i386/newrelic-repo-5-3.noarch.rpm
yum install newrelic-sysmond
# ubuntu特定
echo deb http://apt.newrelic.com/debian/ newrelic non-free >> /etc/apt/sources.list.d/newrelic.list
wget -O- https://download.newrelic.com/548C16BF.gpg | apt-key add -
apt-get update
apt-get install newrelic-sysmond
# 以下通用步骤， license_key由newrelic生成，每个人都各不相同
nrsysmond-config --set license_key=xxxx
/etc/init.d/newrelic-sysmond start # 或者 service newrelic-sysmond start
```

## 参考文献

1. [性能监控的好工具 - NewRelic 简介](https://ruby-china.org/topics/22379)
2. [NewRelic server安装](https://rpm.newrelic.com/accounts/925835/servers/get_started)
